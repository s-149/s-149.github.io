<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <title>Week Generator</title>
    <meta content="Week Generator" name="description" />
    <meta content="Week Generator" name="keywords" />
    <meta name="author" content="Mr.S-149" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link href="assets-blitz/img/logo/logo.jpg" rel="icon" />
    <link href="assets-blitz/img/apple-touch-icon.png" rel="apple-touch-icon" />

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        /* Style untuk background dan efek card */
        
        body {
            background: linear-gradient(45deg, black, #371e51, #2a56a1, black);
            font-family: 'Arial', sans-serif;
            color: white;
        }
        
        .container {
            padding-top: 50px;
            padding-bottom: 50px;
        }
        /* Efek hover pada card */
        
        .card {
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            border-radius: 15px;
            /* background: silver; */
            background: linear-gradient(45deg, rgb(65, 61, 61), black, rgb(4, 4, 39), rgb(45, 38, 38));
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .card:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        
        .card-body {
            text-align: center;
            padding: 20px;
        }
        
        .card-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
        }
        
        .card-text {
            font-size: 1rem;
            color: white;
            margin-top: 10px;
        }
        /* Style untuk teks */
        
        .card-title,
        .card-text {
            font-family: 'Roboto', sans-serif;
        }
        
        .container h2 {
            color: white;
            text-align: center;
            font-size: 2.5rem;
            font-weight: bold;
        }
        /* Animasi Toast */
        
        .toast {
            transition: opacity 0.5s ease-in-out;
        }
        /* Responsif */
        
        @media (max-width: 768px) {
            .card {
                margin-bottom: 20px;
            }
        }
        /* Style button copy */
        
        #copyBtn {
            margin-top: 10px;
            background-color: #007bff;
            color: white;
            border-radius: 5px;
        }
        
        #copyBtn:hover {
            background-color: #0056b3;
        }
    </style>
</head>

<body>
    <div class="container py-4">
        <h2 class="mb-4">Week Generator</h2>

        <div class="row align-items-end g-3">
            <div class="col-md-4">
                <label for="startDate" class="form-label">Start Date:</label>
                <input type="date" id="startDate" class="form-control" />
            </div>

            <div class="col-md-4">
                <label for="endDate" class="form-label">End Date:</label>
                <input type="date" id="endDate" class="form-control" />
            </div>

            <div class="col-md-4 d-grid">
                <button onclick="generateWeeks()" class="btn btn-primary w-100">Generate Weeks</button>
            </div>
        </div>

        <div id="infoPenyesuaian" class="mt-3" style="white-space: pre-line; color: white;"></div>

        <!-- Tombol Copy -->
        <div class="d-flex justify-content-end mt-3">
            <button id="copyBtn" class="btn btn-secondary btn-sm" style="display:none;" data-clipboard-target="#hasil">Copy</button>
        </div>

        <!-- Output cards will be displayed here -->
        <div id="hasil" class="mt-3 row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3"></div>
    </div>

    <!-- Toast notif -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div id="toastNotif" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body" id="toastBody">
                    Berhasil copy hasil ke clipboard!
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Clipboard.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script>

    <script>
        // Nama bulan dalam bahasa Indonesia
        const monthNames = [
            'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',
            'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'
        ];

        function generateWeeks() {
            const startInput = document.getElementById('startDate').value;
            const endInput = document.getElementById('endDate').value;

            if (!startInput || !endInput) {
                alert('Isi tanggal mulai dan tanggal akhir!');
                return;
            }

            let startDate = new Date(startInput);
            let endDate = new Date(endInput);

            if (endDate < startDate) {
                alert('Tanggal akhir tidak bisa lebih awal dari tanggal mulai!');
                return;
            }

            let infoPenyesuaian = '';

            // Penyesuaian tanggal akhir ke Minggu
            let endDay = endDate.getDay();
            if (endDay !== 0) {
                endDate.setDate(endDate.getDate() + (7 - endDay));
                infoPenyesuaian += `Tanggal akhir disesuaikan ke hari Minggu: ${endDate.toISOString().slice(0, 10)}\n`;
            }

            // Penyesuaian tanggal mulai ke Senin
            let startDay = startDate.getDay();
            if (startDay !== 1) {
                startDate.setDate(startDate.getDate() - (startDay === 0 ? 6 : (startDay - 1)));
                infoPenyesuaian += `Tanggal mulai disesuaikan ke hari Senin: ${startDate.toISOString().slice(0, 10)}`;
            }

            document.getElementById('infoPenyesuaian').innerText = infoPenyesuaian;

            let current = new Date(startDate);
            let data = [];

            let weekCountInMonth = 1;
            let currentMonth = current.getMonth();
            let currentYear = current.getFullYear();

            while (current <= endDate) {
                let startOfWeek = new Date(current);
                let endOfWeek = new Date(current);
                endOfWeek.setDate(current.getDate() + 6);

                // Cek bulan, reset week count tiap bulan
                if (startOfWeek.getMonth() !== currentMonth) {
                    weekCountInMonth = 1;
                    currentMonth = startOfWeek.getMonth();
                    currentYear = startOfWeek.getFullYear();
                }

                // Tentukan nama bulan
                let startMonthName = monthNames[startOfWeek.getMonth()];
                let endMonthName = monthNames[endOfWeek.getMonth()];

                // Jika tanggal akhir dalam minggu itu berada di bulan berikutnya, gabungkan kedua nama bulan
                let monthRange = (startMonthName === endMonthName) ? startMonthName : startMonthName + ' - ' + endMonthName;

                data.push({
                    year: currentYear,
                    week: weekCountInMonth,
                    start: startOfWeek.toISOString().slice(0, 10),
                    end: endOfWeek.toISOString().slice(0, 10),
                    month: monthRange, // Tambahkan bulan
                });

                current.setDate(current.getDate() + 7);
                weekCountInMonth++;
            }

            // Urutkan dari tanggal terbaru ke lama
            data.sort((a, b) => new Date(b.start) - new Date(a.start));

            // Assign Week Year: MULAI dari TOTAL ke 1
            let totalWeeks = data.length;
            data = data.map((row, index) => ({
                weekYear: totalWeeks - index,
                ...row,
            }));

            // Display in cards
            let hasilHTML = '';

            data.forEach((row) => {
                hasilHTML += `
                    <div class="col">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title">Minggu ${row.weekYear} (${row.month})</h5>
                                <p class="card-text">
                                    <strong>Periode:</strong> ${row.start} - ${row.end}<br>
                                    <strong>Year:</strong> ${row.year}<br>
                                    <strong>Week:</strong> ${row.weekYear}
                                </p>
                            </div>
                        </div>
                    </div>
                `;
            });

            document.getElementById('hasil').innerHTML = hasilHTML;

            // Tampilkan tombol copy
            document.getElementById('copyBtn').style.display = 'inline-block';
        }

        // Init Clipboard.js
        const clipboard = new ClipboardJS('#copyBtn');

        // Bootstrap Toast instance
        const toastEl = document.getElementById('toastNotif');
        const toast = new bootstrap.Toast(toastEl);

        clipboard.on('success', function(e) {
            // show success toast
            document.getElementById('toastBody').innerText = 'Berhasil copy hasil ke clipboard!';
            toastEl.classList.remove('text-bg-danger');
            toastEl.classList.add('text-bg-success');
            toast.show();
            e.clearSelection();
        });

        clipboard.on('error', function(e) {
            // show error toast
            document.getElementById('toastBody').innerText = 'Gagal copy hasil.';
            toastEl.classList.remove('text-bg-success');
            toastEl.classList.add('text-bg-danger');
            toast.show();
        });
    </script>
</body>

</html>